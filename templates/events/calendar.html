{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4">Calendar</h2>

<div class="row">
    <div class="col-md-12">
        <div id="calendar"></div>
    </div>
</div>

<div class="mt-4">
    <h4>Upcoming Events</h4>
    <div class="row">
        {% for event in events[:10] %}
        <div class="col-md-6 mb-3">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">{{ event.title }}</h5>
                    <p class="card-text">{{ event.description or 'No description' }}</p>
                    <p class="text-muted small mb-0">
                        <i class="fas fa-calendar"></i> {{ event.date.strftime('%Y-%m-%d') }}
                        {% if event.end_date %}
                            to {{ event.end_date.strftime('%Y-%m-%d') }}
                        {% endif %}
                        {% if event.location %}
                            <br><i class="fas fa-map-marker-alt"></i> {{ event.location }}
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- FullCalendar CSS -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css' rel='stylesheet' />
<!-- FullCalendar JS -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js'></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: [
            {% for event in events %}
            {
                title: '{{ event.title }}',
                start: '{{ event.date.strftime("%Y-%m-%d") }}',
                {% if event.end_date %}
                end: '{{ event.end_date.strftime("%Y-%m-%d") }}',
                {% endif %}
                color: '{{ event.color }}',
                description: '{{ event.description|replace("'", "\\'")|safe }}',
                location: '{{ event.location|replace("'", "\\'")|safe }}'
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ],
        eventClick: function(info) {
            alert('Event: ' + info.event.title + '\n' + 
                  'Date: ' + info.event.start.toLocaleDateString() + '\n' +
                  (info.event.extendedProps.description ? 'Description: ' + info.event.extendedProps.description + '\n' : '') +
                  (info.event.extendedProps.location ? 'Location: ' + info.event.extendedProps.location : ''));
        }
    });
    calendar.render();
});
</script>
{% endblock %}
