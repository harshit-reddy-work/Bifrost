{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Calendar Management</h2>
    <div>
        <a href="{{ url_for('admin_create_event') }}" class="btn btn-primary">Create Event</a>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary">‚Üê Back to Dashboard</a>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div id="calendar"></div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0">All Events</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Date</th>
                        <th>Location</th>
                        <th>Type</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event in events %}
                    <tr>
                        <td>{{ event.title }}</td>
                        <td>
                            {{ event.date.strftime('%Y-%m-%d') }}
                            {% if event.end_date %}
                                to {{ event.end_date.strftime('%Y-%m-%d') }}
                            {% endif %}
                        </td>
                        <td>{{ event.location or '-' }}</td>
                        <td><span class="badge" style="background-color: {{ event.color }};">{{ event.event_type }}</span></td>
                        <td>
                            <a href="{{ url_for('admin_edit_event', event_id=event.id) }}" class="btn btn-sm btn-primary">Edit</a>
                            <form method="POST" action="{{ url_for('admin_delete_event', event_id=event.id) }}" class="d-inline" onsubmit="return confirm('Delete this event?');">
                                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- FullCalendar CSS -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css' rel='stylesheet' />
<!-- FullCalendar JS -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js'></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: [
            {% for event in events %}
            {
                title: '{{ event.title }}',
                start: '{{ event.date.strftime("%Y-%m-%d") }}',
                {% if event.end_date %}
                end: '{{ event.end_date.strftime("%Y-%m-%d") }}',
                {% endif %}
                color: '{{ event.color }}',
                description: '{{ event.description|replace("'", "\\'")|safe }}',
                location: '{{ event.location|replace("'", "\\'")|safe }}'
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ],
        eventClick: function(info) {
            alert('Event: ' + info.event.title + '\n' + 
                  'Date: ' + info.event.start.toLocaleDateString() + '\n' +
                  (info.event.extendedProps.description ? 'Description: ' + info.event.extendedProps.description + '\n' : '') +
                  (info.event.extendedProps.location ? 'Location: ' + info.event.extendedProps.location : ''));
        }
    });
    calendar.render();
});
</script>
{% endblock %}
